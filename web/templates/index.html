<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Koda - Codebase Assistant</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
            rel="stylesheet"
        />

        <!-- Highlight.js for code syntax highlighting -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

        <!-- Marked.js for Markdown rendering -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>

        <link rel="stylesheet" href="/static/css/style.css" />
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <svg
                            width="32"
                            height="32"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                            ></path>
                            <polyline
                                points="7.5 4.21 12 6.81 16.5 4.21"
                            ></polyline>
                            <polyline
                                points="7.5 19.79 7.5 14.6 3 12"
                            ></polyline>
                            <polyline
                                points="21 12 16.5 14.6 16.5 19.79"
                            ></polyline>
                            <polyline
                                points="3.27 6.96 12 12.01 20.73 6.96"
                            ></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                        <span>Koda</span>
                    </div>
                </div>

                <div class="sidebar-content">
                    <div class="settings-section">
                        <h3>Settings</h3>

                        <div class="setting-item">
                            <label for="language-filter">Language Filter</label>
                            <select id="language-filter">
                                <option value="">All Languages</option>
                                <option value="java">Java</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                                <option value="typescript">TypeScript</option>
                                <option value="go">Go</option>
                                <option value="rust">Rust</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <label for="hybrid-search">
                                <input
                                    type="checkbox"
                                    id="hybrid-search"
                                    checked
                                />
                                Hybrid Search
                            </label>
                            <span class="setting-hint"
                                >Combines semantic + keyword search</span
                            >
                        </div>

                        <div class="setting-item">
                            <label for="show-sources">
                                <input
                                    type="checkbox"
                                    id="show-sources"
                                    checked
                                />
                                Show Sources
                            </label>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3>Session Stats</h3>
                        <div class="stat-item">
                            <span class="stat-label">Questions Asked</span>
                            <span class="stat-value" id="questions-count"
                                >0</span
                            >
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Sources Retrieved</span>
                            <span class="stat-value" id="sources-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-footer">
                    <button class="clear-chat-btn" id="clear-chat">
                        <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path
                                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                            ></path>
                        </svg>
                        Clear Chat
                    </button>
                </div>
            </aside>

            <!-- Main Chat Area -->
            <main class="chat-main">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- Welcome message -->
                        <div class="message assistant-message">
                            <div class="message-avatar">
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                                    ></path>
                                </svg>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">Koda</span>
                                </div>
                                <div class="message-text">
                                    <p>
                                        Hello! I'm Koda, your codebase
                                        assistant. I can help you understand
                                        your code by answering questions about:
                                    </p>
                                    <ul>
                                        <li>
                                            <strong>Classes & Methods</strong> -
                                            "What does UserService do?"
                                        </li>
                                        <li>
                                            <strong>Code Flow</strong> - "How
                                            does authentication work?"
                                        </li>
                                        <li>
                                            <strong>Architecture</strong> -
                                            "List all the entity classes"
                                        </li>
                                        <li>
                                            <strong>Usage</strong> - "Where is
                                            PaymentProcessor used?"
                                        </li>
                                    </ul>
                                    <p>Ask me anything about your codebase!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <textarea
                                id="chat-input"
                                placeholder="Ask a question about your codebase..."
                                rows="1"
                            ></textarea>
                            <button
                                class="send-btn"
                                id="send-btn"
                                title="Send message (Enter)"
                            >
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon
                                        points="22 2 15 22 11 13 2 9 22 2"
                                    ></polygon>
                                </svg>
                            </button>
                        </div>
                        <div class="input-hints">
                            <span
                                >Press <kbd>Enter</kbd> to send,
                                <kbd>Shift+Enter</kbd> for new line</span
                            >
                        </div>
                    </div>
                </div>
            </main>

            <!-- Sources Panel (slides in) -->
            <aside class="sources-panel" id="sources-panel">
                <div class="sources-header">
                    <h3>Sources</h3>
                    <button class="close-sources-btn" id="close-sources">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="sources-content" id="sources-content">
                    <!-- Sources will be populated here -->
                </div>
            </aside>
        </div>

        <!-- Message Templates -->
        <template id="user-message-template">
            <div class="message user-message">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">You</span>
                    </div>
                    <div class="message-text"></div>
                </div>
                <div class="message-avatar user-avatar">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                        ></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
            </div>
        </template>

        <template id="assistant-message-template">
            <div class="message assistant-message">
                <div class="message-avatar">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                        ></path>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">Koda</span>
                        <span class="message-meta"></span>
                    </div>
                    <div class="message-text"></div>
                    <div class="message-sources"></div>
                </div>
            </div>
        </template>

        <template id="thinking-template">
            <div class="message assistant-message thinking">
                <div class="message-avatar">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                        ></path>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="thinking-indicator">
                        <div class="thinking-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="thinking-text">Thinking...</span>
                    </div>
                </div>
            </div>
        </template>

        <script src="/static/js/chat.js"></script>
    </body>
</html>
