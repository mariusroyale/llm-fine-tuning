# Google Cloud Platform Configuration
gcp:
  project_id: "YOUR_PROJECT_ID" # Your GCP project ID
  location: "us-central1" # Vertex AI region
  staging_bucket: "gs://YOUR_BUCKET_NAME" # GCS bucket for training data (only needed for fine-tuning)

# Fine-Tuning Configuration
training:
  # Model to fine-tune (options: gemini-2.5-pro, gemini-2.5-flash, gemini-2.5-flash-lite)
  base_model: "gemini-2.5-pro"

  # Training hyperparameters
  epochs: 3 # Number of training epochs (1-10)
  learning_rate_multiplier: 1 # Learning rate adjustment (0.1-10)
  adapter_size: 4 # LoRA adapter size (1, 4, 8, 16)

  # Dataset paths (relative to staging_bucket)
  training_data: "training/train.jsonl"
  validation_data: "training/validation.jsonl"

# Data Extraction Settings
extraction:
  # Java-specific settings
  java:
    include_private_methods: true
    include_comments: true
    include_imports: true
    max_class_size_lines: 500 # Skip very large classes

  # General settings
  languages:
    - java
    - python
    - javascript
    - typescript

  # File patterns to include
  include_patterns:
    - "*.java"
    - "*.py"
    - "*.js"
    - "*.ts"

  # Patterns to exclude
  exclude_patterns:
    - "**/test/**"
    - "**/tests/**"
    - "**/*Test.java"
    - "**/*_test.py"

# Training Strategy Configuration
strategy:
  # Options: code_explanation, code_generation, code_review, template_generation, mixed
  type: "code_explanation"

  # System instruction for the fine-tuned model
  system_instruction: |
    You are an expert software developer with deep knowledge of Java,
    design patterns, and software architecture. You understand code
    thoroughly and can explain complex implementations clearly.
    When analyzing code, focus on:
    - Purpose and responsibility of each class/method
    - Design patterns used
    - Key algorithms and data structures
    - Integration points with other components

  # User prompt templates (use {code} and {class_name} as placeholders)
  prompt_templates:
    - "Explain what this Java class does:\n\n```java\n{code}\n```"
    - "What is the purpose of the {class_name} class?\n\n```java\n{code}\n```"
    - "Describe the main functionality of this code:\n\n```java\n{code}\n```"
    - "How does this class work?\n\n```java\n{code}\n```"

# Validation Settings
validation:
  # Split ratio for train/validation
  validation_split: 0.1 # 10% for validation
  max_validation_examples: 500 # Cap validation set size

  # Quality checks
  min_code_length: 50 # Minimum characters in code
  max_code_length: 50000 # Maximum characters
  require_docstring: false # Require docstrings/comments

# Output Settings
output:
  processed_dir: "data/processed"
  train_file: "train.jsonl"
  validation_file: "validation.jsonl"
  stats_file: "dataset_stats.json"

# RAG (Retrieval-Augmented Generation) Settings
rag:
  # Embedding model for semantic search
  embedding_model: "text-embedding-005"

  # LLM for answer generation
  llm_model: "gemini-2.5-pro"

  # Retrieval settings
  top_k: 5 # Number of chunks to retrieve

  # Dependency-aware retrieval
  include_dependencies: true # Fetch related classes automatically
  max_dependencies: 3 # Max dependencies per source chunk

  # Chunking settings
  chunking:
    include_methods: true # Create chunks for individual methods
    include_classes: true # Create chunks for full classes
    include_templates: true # Index JSON templates
    include_documents: true # Index markdown/text documents
    max_chunk_lines: 200 # Maximum lines per chunk
    min_chunk_lines: 3 # Skip tiny chunks

  # PostgreSQL + pgvector database settings
  # Note: When running in Docker, host should be "pgvector" (service name)
  # When running locally, use "localhost"
  pgvector:
    host: "pgvector"  # Use "pgvector" for Docker, "localhost" for local
    port: 5432
    database: "codebase_rag"
    user: "postgres"
    password: "" # Use PGPASSWORD env var for security (set in docker-compose.yml)

  # Optional: Custom system prompt for RAG queries
  system_prompt: |
    You are an expert software engineer assistant. Your task is to answer
    questions about a codebase using the provided code snippets as context.

    Guidelines:
    - Answer based ONLY on the provided code snippets
    - If the answer is not in the provided code, say so clearly
    - Include specific file paths and line numbers when referencing code
    - Provide code snippets in your answer when relevant
    - Be concise but thorough

# Template Generation Settings (for training)
templates:
  # Directory containing JSON templates (relative to data/raw)
  template_dir: "templates"

  # Directory containing Java source files
  java_dir: "java"

  # Optional manual class-to-template mappings file
  mapping_file: null # e.g., "config/template_mappings.json"

  # Include synthetic examples for unmatched classes
  include_synthetic: true

  # System instruction for template generation model
  system_instruction: |
    You are an expert at analyzing Java code and generating corresponding
    JSON templates. You understand Java class structure, fields, methods,
    and inheritance, and can map these to JSON schema representations.

    When generating JSON templates:
    - Analyze the Java class's fields and their types
    - Include appropriate metadata and type mappings
    - Reference related classes by their names
    - Follow the established template structure used in this project
    - Preserve relationships and dependencies between components
